# 变量、作用域和内存问题

本章内容:

-   理解基本类型和引用类型的值
-   理解执行环境
-   理解垃圾收集
    javascript 的变量与其他语言的变量有很大区别。javascript 变量松散类型的本质,决定了它只是在特定时间用于保持特定值的一个名字而已。由于不存在定义某个变量必须按照要保存何种数据类型的规则,变量的值及其数据类型可以在脚本的生命周期内改变。尽管从某种角度看,这可能是一个既有趣又强大,同事又容易出问题的特性,但 javascript 变量实际的复杂程度还远不止如此。

## 基本类型和引用类型的值

ECMAScript 变量可能包含两种不同数据类型的值:基本类性质和引用类型值。基本类型值指的是简单的数据段,而引用类型值指那些可能由多个值构成的对象。
在将一个值赋给变量时,解析器必须确定这个值是基本类性质还是引用类型值。第三章讨论了 5 中基本数据类型: Undefined,Null,Bollean,Number 和 String。这 5 种基本数据类型是按值访问的,因为可以操作保存在变量中的实际的值。
引用类型的值是保存在内存中的对象,与其他语言不用,javascript 不允许直接访问内存中的位置,也就是说不能直接操作对象的内存空间。在操作对象时,实际上是在操作对象的引用而不是实际的对象。为此,引用类型的值是按引用访问的。
**在很多语言中,字符串以对象的形式来表示,因此被认为是引用类型的。ECMASCript 放弃了这一传统。**

### 动态的属性

定义基本类性质和引用类型值的方式是类似的:创建一个变量并为该变量赋值。但是,当这个值保存到变量中后,对不同类型值可以执行的操作则大相径庭。对于引用类型的值,我们可以为其添加属性和方法,也可以改变和删除其属性和方法。
当从一个变量向另一个变量赋值引用类型的值时,同样也会将存储在变量对象中的值赋值一份方法哦新变量分配的空间中。不同的是,这个值的副本实际上是一个指针,而这个指针指向存储在堆中的一个对象。赋值操作结束后,两个变量实际上将引用同一个对象。因此,改变其中一个变量,就会影响另一个变量,如下的例子所示:

```javascript
var obj1 = new Object();
var obj2 = obj1;
obj1.name = "Nicholas";
console.log(obj2.name); // "Nicholas"
```

首先,变量 obj1 保存了一个对象的新示例。然后,这个值被赋值到了 obj2 中;换句话说,obj1 和 obj2 都指向同一个对象。这样,当为 obj1 添加 nmae 属性后,可以通过 obj2 来访问这个属性,因为这个两个变量引用的都是同一个对象。
![图4-2](/img/4/图4-2.png)

### 传递参数

ECMAScript 中所有函数的参数都是按值传递的。也就是说,把函数外部的值赋值给函数内部的参数,就和把值从一个变量赋值到另外一个变量一样。基本类型值的传递如同基本类型变量的赋值一样,而引用类型值的传递,则如同引用类型变量的复制一样。有不少开发人员在这一点上可能会感到困惑,因为访问变量有按值和按引用两种方式,而参数只能按值传递。
在向参数传递基本类型的值时,被传递的值会被复制给一个局部变量(即命名参数,或者用ECMAScript的概念来说,就是arguments对象中的一个元素)。在向参数传递引用类型的值时,会把这个值在内存中的地址复制给一个局部变量,因此这个局部变量的变化会反映在函数的外部。
``` javascript
function addTen(num) {
    num += 10;
    return 10
}
```
